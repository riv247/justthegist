<!DOCTYPE html>
<html lang="en">
<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Test Streaming</title>
		<script>
				function sendData() {
						const input = document.getElementById("input-text");
						const output = document.getElementById("output");

						output.innerHTML = 'Waiting for response...';

						const body = {
							text: input.value,
						};

						const requestOptions = {
								method: "POST",
								headers: {
									"Content-Type": "application/json"
								},
								body: JSON.stringify(body),
						};

						fetch("http://localhost:3207/test", requestOptions)
								.then(response => {
										if (!response.ok) {
												throw new Error(`HTTP error! status: ${response.status}`);
										}

										output.innerHTML = '';
										return response.body;
								})
								.then(rb => {
										const reader = rb.getReader();
										const stream = new ReadableStream({
												start(controller) {
														function push() {
																reader.read().then(({done, value}) => {
																		if (done) {
																				controller.close();
																				return;
																		}
																		controller.enqueue(value);
																		output.textContent += new TextDecoder().decode(value);
																		push();
																});
														};
														push();
												}
										});
										return new Response(stream, { headers: { "Content-Type": "text/plain" } });
								})
								.catch(e => {
										console.error(e);
										output.textContent = "Error: " + e.message;
								});
				}
		</script>
</head>
<body>
		<h1>Test Streaming</h1>
		<textarea id="input-text" rows="4" cols="50" placeholder="Enter your text here..."></textarea>
		<br>
		<button onclick="sendData()">Submit</button>
		<div id="output" style="margin-top: 20px; white-space: pre-wrap;"></div>
</body>
</html>
